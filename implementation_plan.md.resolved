# Space Drift Arena - Multiplayer Fix & Itch.io Prep

## Goal Description
The current [server/server.js](file:///e:/Space%20Drift%20Arena/server/server.js) lacks the Game Relay logic required by the client ([js/Multiplayer.js](file:///e:/Space%20Drift%20Arena/js/Multiplayer.js)). The client waits for `HOST_ROOM_ACK` and expects the server to relay game state, but the server code only handles matchmaking queues. This causes multiplayer to fail (timouts, ghost players).
I will implement a robust Room Manager in [server.js](file:///e:/Space%20Drift%20Arena/server.js) to handle room creation, joining, and data relaying.
I will also create a `ITCH_IO_GUIDE.md` to assist the user in publishing.

## User Review Required
> [!IMPORTANT]
> The [server/server.js](file:///e:/Space%20Drift%20Arena/server/server.js) file will be significantly modified to support game relaying. If you are hosting this server on Render, you MUST redeploy it for the changes to take effect. The local server will work immediately after these changes.

## Proposed Changes

### Server
#### [MODIFY] [server.js](file:///e:/Space%20Drift%20Arena/server.js)
- Add `RoomManager` class or logic.
- Handle `HOST_ROOM` message: Create room, send `HOST_ROOM_ACK`.
- Handle `JOIN_ROOM` message: access room, add player, send `PLAYER_LIST`, broadcast `PLAYER_JOINED`.
- Handle Relay messages (`GAME_STATE`, `PROJECTILES`, `DAMAGE`, `PLAYER_DEATH`, `SPAWN_PICKUP`, `MATCH_TIMER`, `START_GAME`, `LEAVE_ROOM`): Forward to all other players in the specific room.
- Handle WebSocket disconnects to clean up players from rooms and notify others (`PLAYER_LEFT`).

### Documentation
#### [NEW] [ITCH_IO_GUIDE.md](file:///e:/Space%20Drift%20Arena/ITCH_IO_GUIDE.md)
- Step-by-step specific instructions on what files to zip.
- Instructions on how to set the "Kind of project" (HTML) and "Embed options" (SharedArrayBuffer support if needed, though likely not for this simple JS).

## Verification Plan

### Automated Tests
- None available for WebSocket server interaction in the current repo.

### Manual Verification
1.  **Server Start**: Run `node server/server.js`.
2.  **Host Game**: Open game in Browser (using `read_browser_page` or just `open_browser`), click "Host Game". Verify console shows `HOST_ROOM_ACK` and Lobby appears.
3.  **Simulated Join**: Since I can't easily open two browsers with different contexts, I will use a test script `test_multiplayer_connection.js` (I will create this temp script) to connect to `ws://localhost:3000`, send `JOIN_ROOM` and verify it receives `PLAYER_LIST`.
